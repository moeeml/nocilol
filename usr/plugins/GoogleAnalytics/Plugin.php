<?php/** * Google Analytics *  * @package GoogleAnalytics * @author jKey * @version 0.1 * @link http://typecho.jkey.lu/ *//** * 帮助表单里不是很全，添加个 Url 的 */// class My_Typecho_Widget_Helper_Form_Element_Url extends Typecho_Widget_Helper_Form_Element// {	    // /**     // * 初始化当前输入项     // *     // * @access public     // * @param string $name 表单元素名称     // * @param array $options 选择项     // * @return Typecho_Widget_Helper_Layout     // */    // public function input($name = NULL, array $options = NULL)    // {		// foreach ( $options as $value => $url ) {			// $input = new Typecho_Widget_Helper_Layout('div', array('id' => $name . '-0-' . self::$uniqueId));			// $input->html('<a href="'.$url.'" target="_blank">'.$value.'</a>');			// $this->container($input);		// }        // return $input;    // }    // /**     // * 设置表单项默认值     // *     // * @access protected     // * @param mixed $value 表单项默认值     // * @return void     // */    // protected function _value($value)    // {        // $this->input->setAttribute('value', $value);    // }// }class GoogleAnalytics_Plugin implements Typecho_Plugin_Interface{	/**	 * 激活插件方法,如果激活失败,直接抛出异常	 * 	 * @access public	 * @return void	 * @throws Typecho_Plugin_Exception	 */	public static function activate()	{		Typecho_Plugin::factory('Widget_Archive')->footer = array('GoogleAnalytics_Plugin', 'add_google_analytics');		//Typecho_Plugin::factory('admin/header.php')->header($header) = array('GoogleAnalytics_Plugin', 'ga_admin_header');		//return _t('请对插件进行正确设置，以使插件顺利工作！') . $error;	}	/**	 * 禁用插件方法,如果禁用失败,直接抛出异常	 * 	 * @static	 * @access public	 * @return void	 * @throws Typecho_Plugin_Exception	 */	public static function deactivate(){}	/**	 * 获取插件配置面板	 * 	 * @access public	 * @param Typecho_Widget_Helper_Form $form 配置面板	 * @return void	 */	public static function config(Typecho_Widget_Helper_Form $form)	{		//$settings = Helper::options()->plugin('GoogleAnalytics');/*				$cfg_logging = new Typecho_Widget_Helper_Form_Element_Checkbox(			'cfg_logging',			array('to_logging' => ''),			NULL,			'是否开启 Google Analytics 统计',			'并非启用插件开启统计功能，而是只有勾选后才开启的'		);		$form->addInput($cfg_logging);*//*		if ( 1 ) {// notice			$auth_url = GoogleAnalytics_Plugin::build_google_auth_url(				array('next' => Typecho_Widget::widget('Widget_Options')->siteUrl . 'options-plugin.php?config=GoogleAnalytics',					'scope' => 'https://www.google.com/analytics/feeds/',					'secure' => 0,					'session' => 1,					'hd' => 'default'				)			);			$auth_brief = '点击链接登录 Google 认证 Google Analytics 帐户';		} else {			$auth_url = Typecho_Widget::widget('Widget_Options')->siteUrl . 'options-plugin.php?config=GoogleAnalytics&token=deauth';			$auth_brief = '';		}		$cfg_auth = new My_Typecho_Widget_Helper_Form_Element_Url(			'cfg_auth',			array($auth_brief => $auth_url),			NULL,			'点击链接',			'aaaadfsdfasdfasdfsadfsdfasdf'// notice		);		$form->addInput($cfg_auth);*/		$cfg_analytics_uid = new Typecho_Widget_Helper_Form_Element_Text(			'cfg_analytics_uid',			NULL,			'XX-XXXXX-X',			'Google Analytics UID',			''// notice		);		$form->addInput($cfg_analytics_uid);	}	/**	 * 个人用户的配置面板	 * 	 * @access public	 * @param Typecho_Widget_Helper_Form $form	 * @return void	 */	public static function personalConfig(Typecho_Widget_Helper_Form $form){}		/**	 * 构造 Google Auth 链接	 * @access public	 * @param $params array	 * @param $key default null	 * @return 链接	 *//*	public static function build_google_auth_url($params, $key = null)	{		$ret = array();				foreach( (array) $params as $name => $val ) {			$name = urlencode($name);						if ( $key !== null )				$name = $key . "[" . $name . "]";						if ( is_array($val) || is_object($val) )				$ret[] = http_build_query($val, $name);			elseif ($val !== null)				$ret[] = $name . "=" . urlencode($val);		}        		return 'https://www.google.com/accounts/AuthSubRequest?' . implode("&", $ret);	}*/		/**	 * 把 js 添加到 footer	 * 	 * @access public	 */	public static function add_google_analytics()	{		$settings = Helper::options()->plugin('GoogleAnalytics');		?><script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', '<?php echo $settings->cfg_analytics_uid; ?>']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script>		<?php	}		/**	 * 把 js 添加到后台 header	 * 	 * @access public	 *///	public static function add_admin_header(){}}